// Prisma schema for Flash Gift Delivery

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Order {
  id                  String      @id @default(cuid())
  orderNumber         String      @unique
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  // Status
  status              OrderStatus @default(RECEIVED)
  deliveryPhotoUrl    String?

  // Recipient Info
  recipientName       String
  deliveryAddress     String
  gateCode            String?
  specialInstructions String?
  deliveryTimeSlot    DateTime

  // Sender Info
  senderName          String
  senderPhone         String
  senderEmail         String

  // Product Selection
  mainProduct         String // "50_roses", "24_roses", "12_roses"
  mainProductPrice    Int

  // Order Bump
  hasOrderBump        Boolean @default(false)
  orderBumpPrice      Int?

  // Upsells/Downsells
  hasUpsell1          Boolean @default(false)
  upsell1Price        Int?
  hasDownsell1        Boolean @default(false)
  downsell1Price      Int?

  // Greeting Card
  greetingCardOccasion String?
  greetingCardMessage  String?
  greetingCardSignature String?

  // Payment
  stripeSessionId     String?
  stripeCustomerId    String?
  stripePaymentMethodId String?
  stripePaid          Boolean @default(false)
  totalAmount         Int

  // Service Area
  metroArea           String
}

enum OrderStatus {
  RECEIVED
  IN_PROGRESS
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
}

model StoreSettings {
  id              String    @id @default("singleton")
  phoneNumber     String    @default("(602)829-0009")
  metroArea       String    @default("Phoenix Metropolitan Area")
  metroAreaLat    Float?
  metroAreaLng    Float?
  metroAreaRadius Float?    // in miles
  isClosed        Boolean   @default(false)
  reopenDate      DateTime?
  updatedAt       DateTime  @updatedAt
}
